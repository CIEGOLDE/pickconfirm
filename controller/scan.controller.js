sap.ui.define(["cie/pickConfirm/controller/BaseController","cie/pickConfirm/model/formatter","sap/m/MessagePopover","sap/m/MessagePopoverItem","sap/ui/model/Filter"],function(e,t,r,i,s){"use strict";return e.extend("cie.pickConfirm.controller.scan",{onInit:function(){this.oRouter=this.getRouter(this);this.oRouter.getRoute("scan").attachPatternMatched(this.onObjectMatched,this)},onObjectMatched:function(e){jQuery.sap.delayedCall(1e3,this,function(){this.getView().byId("id_DeliveryDocument").getFocusDomRef().focus()})},onChangeSearch:function(){this.setGlobalProperty("/OutbDeliveryItem",[]);var e=[];var t=[];var r=this.getGlobalProperty("/DeliveryDocument");if(r.length<8){return}this.globalBusyOn();var i="/destinations/S4HANACLOUD_BASIC/API_OUTBOUND_DELIVERY_SRV;v=0002";var l=new sap.ui.model.odata.ODataModel(i);e.push(new s("DeliveryDocument",sap.ui.model.FilterOperator.EQ,r));t.push(new sap.ui.model.Sorter("ReferenceSDDocumentItem",true));t.push(new sap.ui.model.Sorter("DeliveryDocumentItem",false));var a={filters:e,success:function(e,t){if(e.results.length!=0){this.setGlobalProperty("/OutbDeliveryItem",this.onSort(e.results));this._length=e.results.length;this.onReadTable()}else{this.globalBusyOff();this.showWarning("No Data")}}.bind(this),error:function(e){this.globalBusyOff()}.bind(this)};var o="/A_OutbDeliveryItem";l.read(o,a)},onReadTable:function(){this.globalBusyOn();var e;var t=[];var r;var i="/destinations/S4HANACLOUD_BASIC/YY1_MANAGE_CUSTOMER_BATCH_CDS";var l=new sap.ui.model.odata.ODataModel(i);for(var a=0;a<this._length;a++){var o=[];o.push(new s("Plant",sap.ui.model.FilterOperator.EQ,this.getGlobalProperty("/OutbDeliveryItem/"+a+"/Plant")));o.push(new s("Material",sap.ui.model.FilterOperator.EQ,this.getGlobalProperty("/OutbDeliveryItem/"+a+"/Material")));o.push(new s("Batch",sap.ui.model.FilterOperator.EQ,this.getGlobalProperty("/OutbDeliveryItem/"+a+"/Batch")));e=new s(o,true);t.push(e)}r=new sap.ui.model.Filter(t,false);var n={filters:[r],success:function(e,t){if(e.results.length>0){var r=this.getGlobalProperty("/OutbDeliveryItem");for(var i=0;i<r.length;i++){for(var s=0;s<e.results.length;s++){if(r[i].Plant==e.results[s].Plant&&r[i].Material==e.results[s].Material&&r[i].Batch==e.results[s].Batch){this.setGlobalProperty("/OutbDeliveryItem/"+i+"/CustmerBatch",e.results[s].CustmerBatch)}}}}this.globalBusyOff();var l=this.getGlobalProperty("/DeliveryDocument");this.oRouter.navTo("list",{DeliveryDocument:l})}.bind(this),error:function(e){this.globalBusyOff();var t=$(e.response.body).find("message").first().text();this.showWarning(t)}.bind(this)};var u="/YY1_MANAGE_CUSTOMER_BATCH";l.read(u,n)},onSort:function(e){e.sort(function(e,t){var r=e.DeliveryDocumentItem;var i=e.HigherLvlItmOfBatSpltItm;var s=t.DeliveryDocumentItem;var l=t.HigherLvlItmOfBatSpltItm;if(i!="000000"&&l!="000000"){if(i==l){if(r>s){return 1}else{return-1}}else{if(i>l){return 1}else{return-1}}}if(i=="000000"&&l=="000000"){if(r>s){return 1}else{return-1}}if(i=="000000"&&l!="000000"){if(r==l){if(r>l){return 1}else{return-1}}else{if(r>l){return 1}else{return-1}}}if(i!="000000"&&l=="000000"){if(i==s){if(r>s){return 1}else{return-1}}else{if(i>s){return 1}else{return-1}}}});return e}})});